<IfModule mod_negotiation.c>
  Options -MultiViews
</IfModule>

<IfModule mod_rewrite.c>
  RewriteEngine On
  # RewriteRule "webstat/(.*\.html)" "webstat/$1" [L]
  # RewriteRule webstat/$1 webstat/(.*\.html) [L]
  RewriteCond %{REQUEST_URI} "/webstat/"
  RewriteRule (.*) $1 [L]
  RewriteBase /
  
  # Разрешаем доступ к package.json
  RewriteRule ^package\.json$ - [L]
  
  # API proxy rules - более точная маршрутизация
  RewriteRule ^api/main$ /api-proxy.php [L]
  RewriteRule ^api/sercxo/(.*)$ /api-proxy.php [L]
  RewriteRule ^api/sercxo$ /api-proxy.php [L]
  
  RewriteRule ^index\.html$ - [L]
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteCond %{REQUEST_FILENAME} !-d
  RewriteRule . /index.html [L]
</IfModule>

# Отключаем кэширование для service-worker.js
<IfModule mod_headers.c>
  <Files "service-worker.js">
    Header set Cache-Control "no-cache, no-store, must-revalidate"
    Header set Pragma "no-cache"
    Header set Expires "0"
  </Files>
  
  # Разрешаем доступ к package.json без кэширования
  <Files "package.json">
    Header set Cache-Control "no-cache, no-store, must-revalidate"
    Header set Pragma "no-cache"
    Header set Expires "0"
  </Files>
  
  # Добавляем кэширование для статических файлов
  <FilesMatch "\.(css|js|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$">
    Header set Cache-Control "public, max-age=31536000"
  </FilesMatch>
</IfModule>
