# Этап 3: Полноценный семантический парсинг и админка

**Цель:** Постепенно разобрать статьи на семантические компоненты, создав инструмент для ручной проверки.

### Шаг 3.1: Усовершенствование парсера

- **3.1.1.** Создать в таблице `artikoloj` новое поле `parsed_content` типа `JSONB`.
- **3.1.2.** Создать поле `status` (например, `raw`, `parsed`, `needs_review`).
- **3.1.3.** Вернуться к Python-парсеру (`new.rueo.ru`). Разработать строгие шаблоны для разных типов статей.
- **3.1.4.** Реализовать логику:
    - Если статья успешно разбирается по шаблону, ее `parsed_content` заполняется JSON-ом, а `status` становится `parsed`.
    - Если парсер встречает неоднозначность, `status` становится `needs_review`.
- **3.1.5.** Запустить парсер на всей базе, чтобы получить первоначальную статистику (сколько статей разобрано, сколько требует проверки).

### Шаг 3.2: Разработка админ-панели

- **3.2.1.** Спроектировать UI/UX админ-панели.
- **3.2.2.** Выбрать технологию (например, отдельное Vue-приложение или рендеринг на стороне сервера с помощью FastAPI+Jinja2).
- **3.2.3.** Реализовать основной функционал:
    - Авторизация для редакторов.
    - Список статей со статусом `needs_review`.
    - Страница редактирования статьи, где:
        - Отображается исходный текст с подсветкой синтаксиса.
        - Отображается `parsed_content` в виде удобной формы (не сырой JSON).
        - Есть возможность вручную исправить разобранные данные и сохранить их.
        - После сохранения статус статьи меняется на `parsed`.

### Шаг 3.3: Интеграция системы отслеживания изменений

- **3.3.1.** Адаптировать логику из `updater.rueo.ru` для работы с новой базой.
- **3.3.2.** Создать механизм хранения "слепков" (хешей) для статей со статусом `parsed`.
- **3.3.3.** При очередном импорте исходников, если текст статьи изменился, а она уже была разобрана (`status == 'parsed'`), ее статус должен автоматически сбрасываться на `needs_review`.

### Шаг 3.4: Обновление публичного API

- **3.4.1.** Создать новую версию API (например, `/api/v2/articles/{article_id}`), которая будет отдавать структурированные JSON-данные из поля `parsed_content`.
- **3.4.2.** Это позволит фронтенду в будущем рендерить статьи на своей стороне, открывая возможности для интерактивности (например, клик по слову в примере для перехода на его статью).
