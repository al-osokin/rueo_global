# Прогресс по Этапу 1 (16 октября 2024)

## Импорт данных

- Создан модуль `backend/app/importer.py`, реализующий перенос логики `vortaro_updater_8.php`.
- Поддерживается чтение исходных текстов из `backend/data/src` с конвертацией из cp1251 в UTF-8 и генерацией файла `tekstoj/klarigo.textile`.
- Заполняются таблицы `artikoloj` и `artikoloj_ru`, формируются поисковые индексы `sercxo`, `sercxo_ru`, а также таблица `neklaraj`.
- Добавлены параметры CLI (`--data-dir`, `--no-truncate`, `--verbose`) и повторное использование для фонового запуска из админки.

## ORM и база данных

- Введён модуль `backend/app/database.py` с SQLAlchemy-движком, сессиями и `init_db()`.
- Описаны модели в `backend/app/models.py`, отражающие MySQL-схему (`artikoloj`, `sercxo`, `neklaraj`, `statistiko` и их русские аналоги).
- Реализована утилита `init_db()` для создания схемы в PostgreSQL на старте приложения.

## Поиск и форматирование

- Добавлен сервис `backend/app/services/search.py`, повторяющий поведение `sercxo.php`:
  - определение языка запроса, выдача результатов по регулярным выражениям и fallback на `LIKE`.
  - формирование HTML-верстки статьи (ссылки, пометы, значки официальных терминов, ударения, форматирование).
  - генерация «похожих слов» по таблице `neklaraj` и логирование статистики запросов в `statistiko`.
- Реализован модуль `backend/app/utils/esperanto.py` для конвертаций `cx` ↔ `ĉ`, обработки `^C` и URL-вариантов.

## API FastAPI

- В `backend/app/main.py` зарегистрированы эндпоинты `/search` и `/suggest`, использующие `SearchService`.
- На событие старта подключён `init_db()`; приложение возвращает HTML-выдачу, совместимую с фронтендом.

## Администрирование

- Создан `backend/app/admin.py` с роутером `/admin`:
  - POST `/admin/import` запускает импорт в фоне, предотвращая параллельный запуск.
  - GET `/admin/import/status` возвращает состояние последнего импорта.
- Логика импорта переиспользует `run_import()` и ведёт учёт статуса (старт, окончание, ошибки).

- Команда `python -m compileall backend/app` выполняется без ошибок (проблемы с правами на `__pycache__` устранены).
