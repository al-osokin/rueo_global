# Этап 2: Реализация полнотекстового поиска

**Цель:** Предоставить пользователям возможность поиска по всему тексту словарных статей.

### Шаг 2.1: Подготовка данных для индексации

- **2.1.1.** Создать в таблице `artikoloj` новое текстовое поле, например, `full_text_content`.
- **2.1.2.** Доработать Python-импортер (из Этапа 1), добавив в него функцию "нормализации" текста для поиска:
    - Замена тильды (`~`) на соответствующую часть заголовочного слова.
    - Раскрытие синонимов, записанных через запятую (`страстно, горячо любить` -> `страстно любить, горячо любить`).
- **2.1.3.** Добавить в импортера конвертацию сокращений и помет (например, `(любовное) увлечение` -> `любовное увлечение, увлечение`).
- **2.1.4.** Удалять ударения и специальные знаки (`'`, `` ` ``, `^`), оставляя только буквенно-цифровые символы.

### Шаг 2.2: Настройка полнотекстового индекса

- **2.2.1.** В PostgreSQL использовать `GIN`-индекс по `to_tsvector('russian', full_text_content)` и отдельный индекс для эсперанто (возможно на основе `simple` словаря).
- **2.2.2.** Настроить лексемы и поиск с учетом `ё/е`, `ĉ/cx` и т.п.
- **2.2.3.** Провести тестирование запросов и сравнить результаты со старым сайтом.

### Шаг 2.3: API для полнотекстового поиска

- **2.3.1.** Создать эндпоинт `/api/search/full-text`, принимающий поисковую строку и язык.
- **2.3.2.** Эндпоинт должен возвращать:
    - Список совпадений с кратким фрагментом (snippet).
    - Ссылку на статью (`/sercxo/{id}`).
    - Вес совпадения (релевантность).
- **2.3.3.** Предусмотреть параметры:
    - фильтр по языку (`eo`, `ru`);
    - пагинация;
    - сортировка (по релевантности или алфавиту).

### Шаг 2.4: Интеграция на фронтенде

- **2.4.1.** Добавить в `rueo_fronto` отдельную страницу (или режим), где поисковая строка выполняет полнотекстовый запрос.
- **2.4.2.** Реализовать отображение сниппетов с подсветкой совпадений.
- **2.4.3.** Добавить фильтры (по языку, типу результата).

### Шаг 2.5: Тестирование и мониторинг

- **2.5.1.** Сравнить выборку результатов со старым поиском, удостовериться в отсутствии регрессий.
- **2.5.2.** Настроить логирование полнотекстовых запросов (новая таблица или расширение `statistiko`).
- **2.5.3.** Подготовить документацию по использованию API и обновить проектную память.
